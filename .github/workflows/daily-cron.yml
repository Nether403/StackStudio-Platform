name: ğŸ” Discovery & Update Engine
on:
  schedule:
    - cron: '0 2 * * *' # Runs at 02:00 UTC every day (low traffic hours)
  workflow_dispatch: # Allow manual triggering
jobs:
  discovery-and-update:
    runs-on: ubuntu-latest
    name: Discovery & Update Engine
    steps:
      - name: ğŸ” Execute Discovery & Update Engine
        run: |
          echo "ğŸš€ Starting Discovery & Update Engine..."
          
          # Call the enhanced discovery endpoint
          response=$(curl -s -X POST \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            -w "%{http_code}" \
            https://stackfast-by-stackstudio-mvp.vercel.app/api/cron/update-github-stats)
          
          http_code="${response: -3}"
          response_body="${response%???}"
          
          echo "Response Code: $http_code"
          echo "Response Body: $response_body"
          
          if [ "$http_code" -eq 200 ]; then
            echo "âœ… Discovery & Update Engine completed successfully!"
            echo "ğŸ‰ $response_body"
          else
            echo "âŒ Discovery & Update Engine failed with code: $http_code"
            echo "ğŸ’¥ Response: $response_body"
            exit 1
          fi
          
          echo "ğŸ§  Enhanced features now include:"
          echo "â€¢ ğŸ“Š GitHub stats updates for existing tools"
          echo "â€¢ ğŸ” New tool discovery from awesome lists"
          echo "â€¢ ğŸ¯ Intelligent search-based discovery"
          echo "â€¢ ğŸ“ˆ Advanced popularity scoring"
          echo "â€¢ ğŸ·ï¸ Smart category inference"
          echo "â€¢ ğŸ“ Draft tool creation for review"
      
      - name: âœ… Completion Summary
        run: |
          echo "ğŸ¯ Discovery & Update Engine completed at $(date)"
          echo "ğŸš€ StackFast database is now more comprehensive and up-to-date!"
